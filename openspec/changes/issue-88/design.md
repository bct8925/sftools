## Context

The query history UI currently reorders items when users click on them to re-run queries (via `HistoryManager.saveToHistory()` which moves duplicates to the top). The history display also shows full SOQL queries, which often start with repetitive prefixes like `SELECT Id,`, making it hard to visually scan and distinguish queries.

**Current Architecture:**
- `HistoryManager` (src/lib/history-manager.ts) handles storage with `saveToHistory()` moving duplicates to top
- `QueryHistory` (src/components/query/QueryHistory.tsx) wraps the modal and manages state
- `HistoryList` (src/components/script-list/ScriptList.tsx) renders each item with preview text
- Preview text is generated by `HistoryManager.getPreview()` which truncates content
- Clicking a history item calls `onSelectQuery()` which loads the query and triggers `saveToHistory()`

## Goals / Non-Goals

**Goals:**
- Add a re-run button to history items that executes queries without reordering
- Trim `SELECT` and `Id` prefixes from query previews for better readability
- Maintain chronological history order when using the re-run button

**Non-Goals:**
- Changing how new queries are added to history (still goes to top)
- Modifying the favorites list behavior
- Changing the query execution flow itself
- Adding re-run functionality to favorites (only history)

## Decisions

### 1. Re-run Button Implementation

**Decision:** Add a new callback prop `onRerun` to `HistoryList` component, distinct from `onLoad`.

**Rationale:**
- `onLoad` currently triggers `onSelectQuery()` → loads query into editor → executes → calls `saveToHistory()` (reorders)
- `onRerun` will execute the query directly without loading into editor or calling `saveToHistory()` (preserves order)
- Keeps the "load into editor" behavior for clicking the item itself
- Clean separation of concerns: load vs. execute

**Alternatives considered:**
- Modify `HistoryManager.saveToHistory()` to accept a flag to skip reordering: Rejected because it couples storage logic to UI behavior and makes the history manager's API more complex
- Remove duplicate detection entirely: Rejected because moving recently-run queries to the top is valuable for newly executed queries

### 2. UI Design for Re-run Button

**Decision:** Add a play icon (▶) button next to the star/delete buttons in the history item actions.

**Rationale:**
- Consistent with existing action button pattern (star, delete)
- Play icon is universally recognized for "execute/run"
- Users can still click the item itself to load into editor (existing behavior preserved)

**Alternatives considered:**
- Replace the entire item click with re-run behavior: Rejected because loading into editor is still useful for editing before execution
- Add a dropdown menu: Rejected as over-engineered for 2 actions

### 3. Query Preview Trimming

**Decision:** Create a specialized preview function for query history that strips common SOQL prefixes.

**Rationale:**
- `HistoryManager.getPreview()` is generic (used for Apex too), so shouldn't have SOQL-specific logic
- Query-specific trimming should happen in the query component layer
- Regex-based trimming handles variations: `SELECT Id,`, `SELECT Id FROM`, `select id,` (case-insensitive)

**Pattern:** `^SELECT\s+Id\s*,?\s*` (case-insensitive)

**Alternatives considered:**
- Modify `HistoryManager.getPreview()` directly: Rejected because Apex history uses the same manager
- Create a subclass of HistoryManager: Rejected as over-engineered; just need a display transform

### 4. Execution Without Editor Load

**Decision:** Add `onRerun` prop to `QueryHistory` that executes the query using the existing `executeQuery()` flow without updating the editor state.

**Rationale:**
- Reuses existing query execution and result handling logic
- Doesn't pollute editor state or trigger history save
- Results appear in tabs as normal

## Risks / Trade-offs

**[Risk] Users may be confused about the difference between clicking item vs. clicking re-run button**
→ Mitigation: Use clear button titles ("Re-run without loading", "Load into editor") and consistent iconography

**[Risk] Re-running a query creates a new result tab but doesn't update the editor**
→ Mitigation: This is intentional and matches user expectations from the issue - they want to quickly flip between queries without changing editor state

**[Trade-off] Two ways to execute a query from history increases complexity**
→ Accepted: The flexibility is explicitly requested and matches patterns in tools like Salesforce Developer Console
